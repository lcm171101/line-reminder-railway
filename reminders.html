
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æé†’æ¸…å–® - LINE Reminder Bot</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card shadow rounded-4 p-4">
      <h2 class="mb-4">æé†’æ¸…å–®</h2>
      <div class="mb-3 d-flex justify-content-between">
        <input type="text" id="searchInput" class="form-control w-50 me-3" placeholder="æœå°‹å§“åæˆ–å…§å®¹â€¦">
        <button class="btn btn-success" onclick="downloadCSV()">ğŸ“¤ åŒ¯å‡º CSV</button>
      </div>
      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
          <thead class="table-light">
            <tr>
              <th>å§“å</th>
              <th>æ™‚é–“</th>
              <th>å…§å®¹</th>
              <th>é€±æœŸ</th>
              <th>åˆ°æœŸæ—¥</th>
              <th>è¨­å®šè€…</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="reminder-body">
            <tr><td colspan="7">è¼‰å…¥ä¸­...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    let rawData = [];

    function renderTable(data) {
      const body = document.getElementById("reminder-body");
      body.innerHTML = data.map(r => `
        <tr>
          <td>${r.name || ""}</td>
          <td>${r.time || ""}</td>
          <td>${r.message || ""}</td>
          <td>${r.repeatType || ""}</td>
          <td>${r.expireDate || ""}</td>
          <td>${r.createdBy || ""}</td>
          <td>
            <button class="btn btn-sm btn-danger" onclick="deleteReminder('${r.id}')">åˆªé™¤</button>
          </td>
        </tr>
      `).join("");
    }

    function downloadCSV() {
      let csv = "å§“å,æ™‚é–“,å…§å®¹,é€±æœŸ,åˆ°æœŸæ—¥,è¨­å®šè€…\n";
      rawData.forEach(r => {
        csv += `${r.name || ""},${r.time || ""},${r.message || ""},${r.repeatType || ""},${r.expireDate || ""},${r.createdBy || ""}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "reminders.csv";
      link.click();
    }

    function deleteReminder(id) {
      if (confirm("ç¢ºèªåˆªé™¤æ­¤æé†’ï¼Ÿ")) {
        fetch("/api/reminders/" + id, { method: "DELETE" })
          .then(res => res.ok ? location.reload() : alert("åˆªé™¤å¤±æ•—"));
      }
    }

    fetch("/api/reminders")
      .then(res => res.json())
      .then(data => {
        rawData = data;
        renderTable(data);
      });

    document.getElementById("searchInput").addEventListener("input", function () {
      const keyword = this.value.toLowerCase();
      const filtered = rawData.filter(r =>
        (r.name || "").toLowerCase().includes(keyword) ||
        (r.message || "").toLowerCase().includes(keyword)
      );
      renderTable(filtered);
    });
  </script>
</body>
</html>
