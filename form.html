
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>建立提醒</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      background: #f5f7fa;
    }
    h2 {
      color: #2c3e50;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 12px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      margin-top: 20px;
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
    }
    .category-badge {
      display: inline-block;
      padding: 4px 8px;
      margin: 4px 0;
      font-size: 12px;
      background: #e0e0e0;
      border-radius: 6px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .nav {
      text-align: right;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="nav"><a href='/reminders'>📋 查看提醒清單</a></div>
    <h2>建立或編輯提醒</h2>
    <form id="reminderForm">
      <label>姓名</label>
      <input type="text" name="name" required>

      <label>主分類 <span class="category-badge">單位內部事項 / 廠區項目</span></label>
      
<select name="mainCategory">
  <option value="單位內部事項">單位內部事項</option>
  <option value="T0">T0</option>
  <option value="T1">T1</option>
  <option value="T2">T2</option>
  <option value="T3">T3</option>
  <option value="T6">T6</option>
  <option value="Fab3">Fab3</option>
  <option value="Fab5">Fab5</option>
</select>


      
<label>次分類</label>
<select name="subCategory">
  <option value="產品">產品</option>
  <option value="DRC">DRC</option>
  <option value="LVS">LVS</option>
  <option value="Netlist">Netlist</option>
  <option value="Other">Other</option>
</select>


      <label>次次分類</label>
<input type="text" name="subSubCategory">

<label for="time">提醒日期</label>
<input type="date" class="form-control" name="time" required>
      </div>
      <input type="hidden" id="time" name="time">

      <label>提醒內容</label>
      <input type="text" name="message" required>

      <label>重複週期</label>
      <select name="repeatType">
        <option value="once">一次</option>
        <option value="daily">每日</option>
        <option value="weekly">每週</option>
        <option value="monthly">每月</option>
      </select>

      <label for="expireDate">停止推播日期</label>
      <input type="date" name="expireDate">

      <label>設定者</label>
      <input type="text" name="createdBy">

      <button type="submit">💾 儲存提醒</button>
    </form>
  </div>

<script>
  function updateTime() {
    const h = document.getElementById('hour').value;
    const m = document.getElementById('minute').value;
    document.getElementById('time').value = h + ":" + m;
  }
  for (let i = 0; i < 24; i++) {
    document.getElementById('hour').innerHTML += `<option value="${String(i).padStart(2,'0')}">${String(i).padStart(2,'0')}</option>`;
  }
  for (let i = 0; i < 60; i++) {
    document.getElementById('minute').innerHTML += `<option value="${String(i).padStart(2,'0')}">${String(i).padStart(2,'0')}</option>`;
  }
  updateTime();

  const params = new URLSearchParams(location.search);
  const id = params.get("id");
  if (id) {
    fetch("/api/reminders/" + id)
      .then(res => res.json())
      .then(data => {
        for (let key in data) {
          if (document.querySelector(`[name=${key}]`)) {
            document.querySelector(`[name=${key}]`).value = data[key];
          }
        }
        const [h, m] = data.time.split(":");
        document.getElementById("hour").value = h;
        document.getElementById("minute").value = m;
        updateTime();
        const form = document.getElementById("reminderForm");
        form.addEventListener("submit", e => {
          e.preventDefault();
          const body = Object.fromEntries(new FormData(form));
          fetch("/api/reminders/" + id, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
          }).then(r => r.text()).then(alert);
        });
      });
  } else {
    document.getElementById("reminderForm").setAttribute("action", "/set-reminder");
    document.getElementById("reminderForm").addEventListener("submit", e => {
  e.preventDefault();
  const body = Object.fromEntries(new FormData(e.target));
  fetch("/set-reminder", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body)
  }).then(() => showToastThenRedirect());
});
  }
</script>

<div id="toast" style="display:none;position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
background:#28a745;color:white;padding:10px 20px;border-radius:5px;box-shadow:0 2px 8px rgba(0,0,0,0.2);">
✅ 提醒已建立成功！即將跳轉...
</div>
<script>
function showToastThenRedirect() {
  const toast = document.getElementById("toast");
  toast.style.display = "block";
  setTimeout(() => location.href = "/reminders", 1500);
}
</script>
</body>

</html>
